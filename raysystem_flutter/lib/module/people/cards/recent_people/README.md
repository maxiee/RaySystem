# 最近添加人物卡片

这是一个新的卡片组件，用于展示最近添加的人物列表，支持分页加载功能。

## 功能特性

### 🎯 核心功能
- **最近人物展示**: 显示最近添加的人物，按ID降序排列（模拟按创建时间排序）
- **分页加载**: 支持滑动到底部自动加载更多数据
- **下拉刷新**: 支持手动刷新数据
- **错误处理**: 完善的网络错误处理和用户友好的错误提示

### 🎨 用户界面
- **现代化设计**: 采用Material Design风格
- **响应式布局**: 适配不同屏幕尺寸
- **流畅动画**: 加载指示器和过渡动画
- **直观操作**: 简洁明了的用户交互

### 🔧 交互功能
- **人物详情**: 点击人物可查看详细信息
- **快速编辑**: 通过菜单可快速编辑人物信息
- **状态指示**: 清晰的加载状态和数据状态提示

## 文件结构

```
lib/module/people/cards/recent_people/
├── recent_people_card.dart          # 主卡片组件
├── recent_people_view_model.dart    # 数据管理和业务逻辑
└── README.md                        # 本文档
```

## 技术实现

### 架构模式
- **MVVM架构**: 使用Provider进行状态管理
- **响应式编程**: 通过ChangeNotifier实现数据绑定
- **组件化设计**: 模块化的组件结构

### 分页策略
由于当前API没有专门的"最近人物"接口，采用以下策略：

1. **数据获取**: 通过搜索API获取人物数据
2. **客户端分页**: 在客户端实现分页逻辑
3. **数据去重**: 基于ID去除重复数据
4. **排序**: 按ID降序排列模拟按创建时间排序

### 错误处理
- **网络错误**: 连接超时、网络不可达等
- **服务错误**: 4xx/5xx HTTP状态码
- **数据错误**: 空数据、格式错误等
- **用户友好**: 提供清晰的错误信息和重试选项

## 使用方法

### 1. 添加到命令系统
在 `people_commands.dart` 中已添加新命令：

```dart
Command(
  command: 'people-recent',
  title: '最近添加',
  icon: Icons.history,
  callback: (context, cardManager) {
    cardManager.addCard(RecentPeopleCard(), wrappedInRayCard: false);
  },
)
```

### 2. 直接使用组件
```dart
RecentPeopleCard()
```

## 配置选项

### 分页设置
在 `RecentPeopleViewModel` 中可以调整分页大小：

```dart
static const int _pageSize = 20; // 每页显示的人物数量
```

### 搜索策略
可以在 `_fetchRecentPeople` 方法中调整搜索的姓氏列表：

```dart
final commonNames = ['张', '王', '李', '赵', '刘', '陈', '杨', '吴', '周', '郑'];
```

## 未来改进

### API优化
- 建议后端提供专门的 `/people/recent` 接口
- 支持真正的服务器端分页
- 添加排序和过滤参数

### 功能增强
- 添加搜索过滤功能
- 支持不同的排序方式
- 添加收藏和标签功能
- 支持批量操作

### 性能优化
- 实现虚拟滚动（对于大量数据）
- 添加数据缓存机制
- 优化网络请求策略

## 依赖关系

- `flutter/material.dart`: UI框架
- `provider`: 状态管理
- `openapi`: API客户端
- `dio`: HTTP客户端
- `built_collection`: 不可变集合

## 注意事项

1. **API限制**: 当前实现基于搜索API，可能无法获取所有人物数据
2. **性能考虑**: 对于大量数据，建议使用服务器端分页
3. **数据一致性**: 客户端排序可能与实际创建时间不完全一致
4. **网络优化**: 多个搜索请求可能影响性能，建议优化为单个API调用

## 贡献指南

如需改进此组件，请遵循以下原则：
- 保持代码的可读性和可维护性
- 添加适当的错误处理
- 编写清晰的注释和文档
- 遵循项目的代码规范
